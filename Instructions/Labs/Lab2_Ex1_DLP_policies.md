---
lab:
  title: 演習 1 - DLP ポリシーを実装して管理する
  module: Module 2 - Implement Data Loss Prevention
---
## WWL テナント - 使用条件

講師が指導するトレーニング配信の一環としてテナントを提供されている場合は、講師が指導するトレーニングでハンズオンラボをサポートする目的でテナントを利用できることに注意してください。

テナントを共有したり、ハンズオンラボ以外の目的で使用したりしないでください。 このコースで使われるテナントは試用版テナントであり、クラスが終了し、拡張機能の対象となっていない場合は、使用したりアクセスしたりすることはできません。

テナントを有料サブスクリプションに変換することはできません。 このコースの一環として取得したテナントは Microsoft Corporation の財産のままであり、当社はいつでもアクセス権とリポジトリを取得する権利を留保します。

# ラボ 2 - 演習 1: DLP ポリシーを実装して管理する

Contoso Ltd. で情報セキュリティ管理者として新しく採用された Joni Sherman は、Microsoft 365 全体で機密性の高い顧客データを保護するために、データ損失防止 (DLP) ポリシーを構成するよう求められました。 このラボでは、Microsoft Purview と Microsoft Defender を使用して、クレジット カード番号や従業員 ID などの機密情報の共有を検出して制限する DLP ポリシーを作成および管理します。

**タスク**:

1. シミュレーション モードで DLP ポリシーを作成する
1. DLP ポリシーを修正する
1. PowerShell で DLP ポリシーを作成する
1. シミュレーション モードでポリシーをアクティブ化する
1. ポリシーの優先順位を修正する
1. Microsoft Defender でファイル検査を有効にする
1. Microsoft Defender のファイル ポリシーを作成する

## タスク 1: シミュレーション モードで DLP ポリシーを作成する

このタスクでは、Teams メッセージのクレジット カード番号を対象とする DLP ポリシーをシミュレーション モードで作成します。 このポリシーは、ユーザーが機密性の高いコンテンツを共有しようとしたときに通知を送り、ユーザーが正当な理由によって上書きできるようにします。

1. **SC-401-CL1\admin** アカウントを使って Client 1 VM (SC-401-CL1) にログインします。

1. **Microsoft Edge** で、 **`https://purview.microsoft.com`** に移動し、**Joni Sherman** として Microsoft Purview ポータルにログインします。 `JoniS@WWLxZZZZZZ.onmicrosoft.com` としてサインインします (この ZZZZZZ は、ラボ ホスティング プロバイダーから提供された自分専用のテナント プレフィックスです)。 ユーザー アカウントのパスワードは、ラボ ホスティング プロバイダーから提供されます。

1. **[ソリューション]** > **[データ損失防止]** > **[ポリシー]** を選択します。

1. **[ポリシー]** ページで、**[+ ポリシーの作成]** を選択します。

1. **[保護する情報]** ページで、**[Enterprise applications & devices]** を選択し、**[次へ]** を選択します。

1. **[テンプレートの利用またはカスタム ポリシーの作成]** ページで、**[カスタム]** をカテゴリとして選択し、**[規制]** の下の **[カスタム ポリシー]** を選択します。

1. [**次へ**] を選択します。

1. **[DLP ポリシーの名前の設定]** ページで、以下を入力します。

   - **名前**: `DLP - Credit Card Protection`
   - **説明**: `Detect and restrict sharing of credit card numbers in Teams messages.`

1. [**次へ**] を選択します。

1. [**管理単位を割り当てる**] ページで、[**次へ**] を選択します。

1. **[ポリシーを適用する場所の選択]** ページで **[Teams チャットとチャネル メッセージ]** の場所のみを有効にします。 その他の場所が選択されている場合は、選択を解除します。

1. [**次へ**] を選択します。

1. **[ポリシー設定の定義]** ページで、**[詳細なDLPルールを作成またはカスタマイズします]** を選択し、**[次へ]** を選択します。

1. **[詳細な DLP ルールのカスタマイズ]** ページで、**[+ ルールを作成]** を選択します。

1. **[ルールの作成]** ポップアップ ページ:
    - **[名前]** フィールドに「`Credit card information`」と入力します。

1. **[条件]** で、**[+ 条件の追加]** > **[コンテンツが Microsoft 365 から共有されている]** を選択します。

1. **[コンテンツが Microsoft 365 から共有されている]** セクション:
    - **[組織外の連絡先]** オプションを選択します。

1. **[+ 条件の追加]** > **[コンテンツに含まれている]** を選択します。

1. 新しい **[コンテンツに含まれている]** セクション:
    - **[追加]** > **[機密情報の種類]** を選択します。
    - **[機密情報の種類]** ページで、Credit Card Number を検索して選択し、**[追加]** を選択します。`Credit Card Number`

1. **[操作]** で、**[+ 処理の追加]** > **[Microsoft 365 の場所にあるコンテンツへのアクセスを制限または暗号化する]** を選択します。

1. **[Microsoft 365 の場所にあるコンテンツへのアクセスを制限または暗号化する]** セクション:
    - **[組織外のユーザーのみをブロックする]** を選択します。

1. **[ユーザー通知]**:
    - **[通知を使用してユーザーに通知し、機密情報の適切な使用についてユーザーを教育します。]** の切り替えをオンにします。
    - **[Office 365 サービスのユーザーにポリシー ヒントまたはメール通知を使用して通知する]** チェックボックスをオンにします。

1. **[ユーザーによる上書き]**:
    - **[ユーザーがFabric(Power BI を含む)、Exchange、SharePoint、OneDrive、Teams のポリシーの制限を上書きできるようにします]** チェックボックスをオンにします。
    - **[上書きするには業務上の理由が必要です]** チェックボックスをオンにします。

1. **[インシデント レポート]** の **[管理者通知とレポートでこの重大度レベルを使用します]** ドロップダウン:
    - **[低]** を選択します。

1. **[ルールの作成]** の下部にある **[保存]** を選択します。

1. **[詳細な DLP ルールをカスタマイズする]** ページに戻り、**[次へ]** を選択します。

1. **[ポリシー モード]** ページで、**[シミュレーション モードでポリシーを実行する]** を選択し、**[シミュレーション モード中にポリシー ヒントを表示する]** を選択します。

1. [**次へ**] を選択します。

1. **[確認して完了]** ページで設定を確認し、**[送信]** を選択します

1. **[新しいポリシーが作成されました]** ページで、 **[完了]** を選択します。

コンテンツのクレジット カード番号をスキャンし、業務上の正当な理由による上書きを許可する DLP ポリシーを作成しました。

## タスク 2 : DLP ポリシーを修正する

このタスクでは、既存の DLP ポリシーのスコープを拡大して、Exchange メールを含めます。 これにより、追加の通信チャネル間で一貫した保護を実現できます。

1. Client 1 VM (SC-401-CL1) には **SC-401-CL1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. 引き続き Microsoft Purview の **[ポリシー]** ページにある必要があります。 **Microsoft Edge** を開き、`https://purview.microsoft.com` に移動します。 **[ソリューション]** > **[データ損失防止]** > **[ポリシー]** を選択します。

1. **[ポリシー]** ページで、先ほど作成した **[DLP - Credit Card Protection]** のチェックボックスをオンにし、**[ポリシーの編集]** を選択してポリシー構成を開きます。

1. **[DLP ポリシーの名前の設定]** ページで、説明を`Detect and restrict sharing of credit card numbers in Teams and Exchange messages.`に編集します。

1. [**次へ**] を選択します。

1. [**管理単位を割り当てる**] ページで、[**次へ**] を選択します。

1. **[ポリシーを適用する場所の選択]** ページで **[Exchange メール]** チェックボックスをオンにして、DLP ポリシーにこの場所を追加します。

1. **[確認と完了]** ページが表示されるまで、**[次へ]** を選択します。

1. **[確認と完了]** ページで **[送信]** を選択して、行った変更をポリシーに適用します。

1. ポリシーが更新されたら、**[ポリシーが更新されました]** ページで **[完了]** を選択します。

Teams メッセージと共にメールをスキャンするようにポリシーを更新できました。

## タスク 3: PowerShell で DLP ポリシーを作成する

このタスクでは、PowerShell を使用して DLP ポリシーを作成し、メールによる従業員 ID の共有をブロックします。 このアプローチは、スクリプトを使用してポリシー設定を定義および適用する方法を示します。

1. 引き続き Client 1 VM (SC-401-CL1) に **SC-401-CL1\admin** アカウントでログインしている必要があります。

1. タスク バーにある **[開始]** ボタンを右クリックして管理者特権の PowerShell ウィンドウを開き、**[ターミナル (管理者)]** を選択します。

1. ターミナル ウィンドウで**モジュールのインストール** コマンドレットを実行して、最新の **Exchange Online PowerShell** モジュール バージョンをインストールします。

    ```powershell
    Install-Module ExchangeOnlineManagement
    ```

1. 信頼されていないレポジトリ セキュリティ ダイアログで、[はい] を示す **[Y]** を選択して確定し、**Enter** キーを押します。  この処理は、完了までに時間がかかる場合があります。

1. **Connect-IPPSSession** コマンドレットを実行して、Security & Compliance PowerShell に接続します。

    ```powershell
    Connect-IPPSSession
    ```

1. **[アカウントにサインイン]** ポップアップ ウィンドウで **Joni Sherman** (`JoniS@WWLxZZZZZZ.onmicrosoft.com`) としてサインインします (この ZZZZZZ は、ラボ ホスティング プロバイダーから提供された自分専用のテナント プレフィックスです)。 ユーザー アカウントのパスワードは、ラボ ホスティング プロバイダーから提供されます。

1. **New-DlpCompliancePolicy** コマンドレットを実行して、すべての Exchange メールボックスをスキャンする DLP ポリシーを作成します。

    ```powershell
    New-DlpCompliancePolicy -Name "EmployeeID DLP Policy" -Comment "This policy blocks sharing of Employee IDs" -ExchangeLocation All
    ```

1. **New-DlpComplianceRule** コマンドレットを実行して、前の手順で作成した DLP ポリシーに DLP ルールを追加します。 このポリシーでは、前の演習で作成した **Contoso Employee IDs** の機密情報の種類を使用します。

    ```powershell
    New-DlpComplianceRule -Name "EmployeeID DLP rule" -Policy "EmployeeID DLP Policy" -BlockAccess $true -ContentContainsSensitiveInformation @{Name="Contoso Employee IDs"}
    ```

1. **Get-DLPComplianceRule** コマンドレットを実行して、**EmployeeID DLP ルール**を確認します。

    ```powershell
    Get-DLPComplianceRule -Identity "EmployeeID DLP rule"
    ```

PowerShell を使用して、従業員 ID の共有をブロックする DLP ポリシーを作成できました。

## タスク 4: シミュレーション モードでポリシーをアクティブ化する

DLP ポリシーをシミュレーションでテストしたので、次にポリシーをアクティブにして、アクションの適用を開始します。

1. Client 1 VM (SC-401-CL1) には **SC-401-CL1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. **Microsoft Edge** で、`https://purview.microsoft.com` > **[ソリューション]** > **[データ損失防止]** に移動し、左側のサイドバーから **[ポリシー]** を選択して DLP ポリシーに移動します。

1. **[ポリシー]** ページで **[DLP - Credit Card Protection]** ポリシーを選択します。

1. 右側のポップアップの下部にある **[シミュレーションの表示]** を選択します。

1. シミュレーション ページで、少し時間を取って次を確認します。

   - **[シミュレーションの概要]** タブ。スキャンの進行状況、一致の合計数、スキャンの状態が場所別に表示されます。
   - **[確認する項目] タブ**。予測された一致が使用可能になると表示されます。
   - **[アラート] タブ**。シミュレーション モードでトリガーされたアラートが一覧表示されます。

1. シミュレーション モードで分析情報を確認した後、**[ポリシーを有効にする]** を選択し、**[確認]** を選択して DLP ポリシーをアクティブ化します。

   ポリシーが正常に公開されたことを示す確認のポップアップが表示されます。

ポリシーがアクティブになり、Teams と Exchange でクレジット カード情報に対する制限が適用されるようになりました。

## タスク 5 – ポリシーの優先順位を修正する

複数のポリシーが存在する場合、その優先度によって最初に適用されるポリシーが決まります。 このタスクでは、EmployeeID DLP Policy を最も高い優先度に移動させます。

1. Client 1 VM (SC-401-CL1) には **SC-401-CL1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. **Microsoft Edge** で、Microsoft Purview ポータルのタブが引き続き **[ポリシー]** ページに開かれているはずです。 **Microsoft Edge** を開き、`https://purview.microsoft.com` に移動します。 **[ソリューション]** > **[データ損失防止]** > **[ポリシー]** を選択します。

1. **[ポリシー]** ページで、**[EmployeeID DLP Policy]** を選択します。

1. 上部のナビゲーション リボンから **[優先順位の再設定]** を選択し、**[先頭に移動(優先度が最も高い) ]** を選択します。

1. **[データ損失防止]** ウィンドウで、 **[更新]** を選択し、[ポリシー] タブの **[順序]** の列で優先順位を確認します。

EmployeeID DLP Policy が他のポリシーよりも優先されるように、ポリシーの優先順位を更新しました。

## タスク 6 - Microsoft Defender でファイル検査を有効にする

一部のファイル ポリシーでは、保護されたファイルの内容を検査するためにアクセス権が必要です。 このタスクでは、Microsoft Defender が OneDrive ファイルと SharePoint ファイルの内容について機密情報がないかスキャンするために必要なアクセス許可を付与します。

1. 引き続き、**SC-401-CL1\admin** アカウントで Client 1 VM (SC-401-CL1) にログインし、Joni Sherman としてサインインしておく必要があります。

1. InPrivate ウィンドウで **Microsoft Edge** を開くには、タスク バーから Microsoft Edge を右クリックし、**[新しい InPrivate ウィンドウ]** を選択します。

1. **`https://security.microsoft.com`** に移動して Microsoft Defender XDR にアクセスし、**MOD 管理者**である `admin@WWLxZZZZZZ.onmicrosoft.com` としてサインインします (この ZZZZZZ は、ラボ ホスティング プロバイダーから提供された自分専用のテナント プレフィックスです)。 管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. 左側のサイドバーで、**[システム]** > **[設定]** を選択し、**[クラウド アプリ]** を選択します。

1. **[クラウド アプリ]** ウィンドウの左ペインで、**[情報保護]** セクションまで下にスクロールし、**[Microsoft Information Protection]** を選択します。

1. **[保護されたファイルを検査]** で、**[アクセス許可を付与する]** を選択してファイル検査を有効にします。

1. プロンプトに従って Microsoft Entra ID で必要なアクセス許可を与えると、Microsoft Defender for Cloud Apps でファイル検査が**アクティブ**であることが表示されます。

1. InPrivate ウィンドウを閉じます。

Defender でファイル検査が有効になり、ファイル ポリシーで機密性の高いコンテンツをスキャンできるようになりました。

## タスク 7 - Microsoft Defender のファイル ポリシーを作成する

このタスクでは、OneDrive と SharePoint のクレジット カード番号を含むファイルを特定して検疫するファイル ポリシーを Microsoft Defender で作成します。

1. 引き続き Client 1 VM (SC-401-CL1) に **SC-401-CL1\admin** アカウントでログインしている必要があります。

1. Joni Sherman としてサインインしている Microsoft Edge ウィンドウに戻ります。 タブを更新して、新しいアクセス許可がアクティブになっていることを確認します。

1. **Microsoft Defender** ポータルの左側のナビゲーションで、**[クラウド アプリ]** > **[ポリシー]** を選択し、**[ポリシー管理]** を選択します。

1. **[ポリシー]** ページで、 **[+ ポリシーを作成]** を選択し、 **[ファイル ポリシー]** を選択します。

1. **[ファイル ポリシーの作成]** ページで、次の構成を行います。

   - **ポリシー名**: `Credit card information for files`
   - **ポリシーの重大度**: **低**
   - **カテゴリ**: **DLP**
   - **説明**: `Protect credit card numbers from being shared in files.`
   - **[次のすべてに一致するファイル] セクション**で、次を行います。
      - 最初のフィルターの場合は、ドロップダウンを次のように構成します。**アクセス レベルが次と等しい**、公開 (**インターネット**)、公開、外部に [内部] を追加します。
      - 2 番目のフィルターでは、ドロップダウンを次のように構成します。 **最終変更後 (日付)** および今日の日付を使用します。

          ![内部オプションが追加された、一致するファイルのドロップダウンを示すスクリーンショット。](../Media/files-matching-internal.png)

   - **[検査方法]** ドロップダウン メニューで、**[データ分類サービス** ]を選択します。
   - **[検査の種類を選択]** ドロップダウン メニューで **[機密情報の種類]** を選択します。
   - **[機密情報の種類の選択]** ダイアログで、`Credit Card Number` のチェックボックスを検索してオンにします。
      - **[機密情報の種類の選択]** ダイアログの右上にある **[完了]** を選択します。

   - **ガバナンス アクション**で、**Microsoft OneDrive for Business** を次のように展開します。
      - **[ユーザー検疫に配置]** のチェック ボックスをオンにする
   - **Microsoft SharePoint Online** に対して同じプロセスを繰り返す
      - **[ユーザー検疫に配置]** のチェック ボックスをオンにする

1. ページの下部にある **[作成]** を選択し、ファイル ポリシーを作成します。

クレジット カードの機密データを含むファイルを検出して検疫するファイル ポリシーが正常に作成されました。
